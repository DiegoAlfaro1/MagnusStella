<%- include('includes/navigation.ejs') %>

<link rel="stylesheet" href="/ccs/usuarios-resenia.css">


    <div class="container-fluid">
        <div class="table-responsive">
            <div class="table-wrapper">

                <div class="table-title">
                    <div class="text">
                        <h2><b>Control de usuarios</b></h2>
                    </div>
                    <div class="buttons">
                        <a href="/users/signup/<%= marca %>" class="btn btn-primary"><i class='bx bx-user-plus icon'></i><span>Crear usuario</span></a>
                        <a href="#" class="btn btn-primary"><i class='bx bx-list-plus icon'></i><span>Crear Rol</span></a>
                    </div>
                </div>

                <div id="respuesta_ajax">

                    <div id="notificacion">

                        <% if(usuarios.length < 1) {  %>
                            <div class="notification is-info">
                                No existen Usuarios.
                            </div>
                        <% } %>
                    </div>

                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Id#</th>
                                <th>Nombre</th>
                                <th>Correo</th>
                                <th>Rol</th>
                                <th>Estado</th>
                                <th>Acci√≥n</th>
                            </tr>
                        </thead>
                        
                        <tbody>
                            <% for (let usuario of usuarios) { %>
                            <tr>
                                <td><%= usuario.idUsuario %></td>
                                <td><a href="#"><img src="/uploads/<%= usuario.Imagen %>" class="avatar" alt="Avatar"> <%= usuario.Nombre %></a></td>
                                <td><%= usuario.Correo %></td>
                                <td><%= usuario.IDRol %></td>
                                <% if (usuario.Estado ==="0") { %>
                                <td><span class="status text-warning">&bull;</span>Inactivo</td>
                                <% } else { %>
                                <td><span class="status text-success">&bull;</span>Activo</td>
                                <% } %>
                                <td>
                                    <a class="settings" title="Editar" data-placement="top" data-toggle="tooltip" href="/usuarios/editar/<%= usuario.idUsuario%>/<%= marca %>" ><i class='bx bxs-edit-alt'></i></a>
                                    <button onclick="eliminar(<%=usuario.idUsuario%>)" href="#" class="delete" title="Borrar" data-placement="top" data-toggle="tooltip"><i class='bx bx-trash'></i></button>
                                </td>
                            </tr>
                            <% }; %>
                        </tbody>
                    </table>

                    <div class="clearfix">
                        <div class="hint-text">Mostrando <b><%= pageSize * (currentPage - 1) + 1 %></b> a <b><%= Math.min(pageSize * currentPage, totalUsers) %></b> de <b><%= totalUsers %></b> resultados</div>
                            <ul class="pagination">
                                <% if(currentPage > 1) { %>
                                <li class="page-item"><a href="/usuarios/<%= currentPage - 1 %>/<%= marca %>" class="page-link">Anterior</a></li>
                                <% } %>

                                <% for(let i = 1; i <= totalPages; i++) { %>
                                <li class="page-item <%= i === currentPage ? 'active' : '' %>"><a href="/usuarios/<%= i %>/<%= marca %>" class="page-link"><%= i %></a></li>
                                <% } %>

                                <% if(currentPage < totalPages) { %>
                                <li class="page-item"><a href="/usuarios/<%= currentPage + 1 %>/<%= marca %>" class="page-link">Siguiente</a></li>
                                <% } %>

                            </ul>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>

    
    <script>
        const eliminar = (id) => {
            console.log("ELiminando")
            fetch('/usuarios/delete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        // 'csrf-token': csrf
                    },
                    body: JSON.stringify({id: id})
                }).then(result => {
                    console.log("Algo")
                    return result.json(); //Regresa otra promesa
                }).then(data => {
                    console.log(data);
                    console.log("Dentro de Algo")
                    location.reload();
                }).catch(err => {
                    console.log(err);
                });
                
        };
    </script>


<%- include('includes/footer.ejs') %>
