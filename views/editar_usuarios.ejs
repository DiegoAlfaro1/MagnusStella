<%- include('includes/navigation.ejs')%>
  <% for (let usuario of usuarios) { %>
    <div class="signup-box box">
      <div class="signup-title title">
        <h4>Nombre de usuario: <%= usuario.Nombre%>
        </h4>
      </div>
      <form id="editUserForm" action="/usuarios/editar/<%= usuario.idUsuario %>" method="POST">
        <input type="hidden" name="uIdusuario" value="<%= usuario.idUsuario %>" />
        <input type="hidden" name="uPassword" value="<%= usuario.Password %>" />
        <input type="hidden" id="_csrf" name="_csrf" value="<%= csrfToken %>" />
        <div class="credential-input">
          <label class="label" for="correo">Correo: </label>
          <input class="input is-success" type="text" placeholder="Text input" value="<%= usuario.Correo%>"
            name="correo" id="correo" type="text" required />
        </div>

        <div class="credential-input">
          <label class="label" for="password">Password: </label>

          <div class="passwordInput">
            <input class="input is-success" type="password" placeholder="Text input" value="" name="password" id="password"
              type="text" />
            <button type="button" id="togglePasswordBtn" onclick="togglePassword()">
              <i class="fa fa-eye" aria-hidden="true"></i>
            </button>
          </div>

          <span id="passwordError" class="error"></span>
        </div>

        <div class="credential-input">
          <label class="label" for="idrol">IDRol: </label>
          <input class="input is-success" type="text" placeholder="Text input" value="<%= usuario.IDRol%>" name="idrol"
            id="idrol" type="text" required />
        </div>
        <div class="ingresarBtn">
          <input type="submit" value=" Guardar " class="ingresar-btn" />
          <a href="/usuarios/1/<%= marca %>">Cancelar</a>
        </div>
      </form>
    </div>
    <% } %>
      <%- include('includes/footer.ejs') %>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
          $(document).ready(function () {
            $('#password').on('input', function () {
              var password = $(this).val();
              var csrfToken = $('input[name="_csrf"]').val();

              // Make an AJAX request to the server to validate the password
              $.ajax({
                type: 'POST',
                url: '/users/validate-password',
                data: { password: password, _csrf: csrfToken },
                success: function (response) {
                  if (response.valid) {
                    // Password is valid, clear the error message
                    $('#passwordError').text('');
                  } else {
                    // Password is invalid, display the error message
                    $('#passwordError').text(response.message);
                  }
                },
                error: function () {
                  alert('An error occurred while validating the password.');
                }
              });
            });

            // Prevent form submission if password is invalid
            $('#editUserForm').submit(function (event) {
              var passwordError = $('#passwordError').text();
              if (passwordError) {
                event.preventDefault();
                alert('Please enter a valid password.');
              }
            });
          });
        </script>